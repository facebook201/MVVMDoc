<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hook | MVVM框架集</title>
    <meta name="description" content="飘飘乎如遗世独立 羽化而登仙">
    <link rel="icon" href="/MVVMDoc/pkq.jpeg">
    
    <link rel="preload" href="/MVVMDoc/assets/css/0.styles.a5345176.css" as="style"><link rel="preload" href="/MVVMDoc/assets/js/app.0ce0ee86.js" as="script"><link rel="preload" href="/MVVMDoc/assets/js/16.500fcba6.js" as="script"><link rel="prefetch" href="/MVVMDoc/assets/js/10.8c942620.js"><link rel="prefetch" href="/MVVMDoc/assets/js/11.22b73831.js"><link rel="prefetch" href="/MVVMDoc/assets/js/12.bc9ef78f.js"><link rel="prefetch" href="/MVVMDoc/assets/js/13.9b0b8518.js"><link rel="prefetch" href="/MVVMDoc/assets/js/14.09b24188.js"><link rel="prefetch" href="/MVVMDoc/assets/js/15.16367390.js"><link rel="prefetch" href="/MVVMDoc/assets/js/17.2160c3ed.js"><link rel="prefetch" href="/MVVMDoc/assets/js/18.a1b98696.js"><link rel="prefetch" href="/MVVMDoc/assets/js/19.3774a35c.js"><link rel="prefetch" href="/MVVMDoc/assets/js/2.a1f8879c.js"><link rel="prefetch" href="/MVVMDoc/assets/js/20.f39149de.js"><link rel="prefetch" href="/MVVMDoc/assets/js/21.9fe5b26c.js"><link rel="prefetch" href="/MVVMDoc/assets/js/22.2676caf5.js"><link rel="prefetch" href="/MVVMDoc/assets/js/23.4b011396.js"><link rel="prefetch" href="/MVVMDoc/assets/js/24.673ebd68.js"><link rel="prefetch" href="/MVVMDoc/assets/js/25.753ad69b.js"><link rel="prefetch" href="/MVVMDoc/assets/js/26.0ecb2d6f.js"><link rel="prefetch" href="/MVVMDoc/assets/js/27.f9450161.js"><link rel="prefetch" href="/MVVMDoc/assets/js/28.17f8fd8b.js"><link rel="prefetch" href="/MVVMDoc/assets/js/29.9faae8cf.js"><link rel="prefetch" href="/MVVMDoc/assets/js/3.c5e28420.js"><link rel="prefetch" href="/MVVMDoc/assets/js/30.bc250b25.js"><link rel="prefetch" href="/MVVMDoc/assets/js/31.bda37d6f.js"><link rel="prefetch" href="/MVVMDoc/assets/js/32.bbbeaf28.js"><link rel="prefetch" href="/MVVMDoc/assets/js/33.873dcf9d.js"><link rel="prefetch" href="/MVVMDoc/assets/js/34.a482e32a.js"><link rel="prefetch" href="/MVVMDoc/assets/js/35.3cb5f8ee.js"><link rel="prefetch" href="/MVVMDoc/assets/js/36.dbefa361.js"><link rel="prefetch" href="/MVVMDoc/assets/js/37.7f28fb99.js"><link rel="prefetch" href="/MVVMDoc/assets/js/38.fcc3ff8b.js"><link rel="prefetch" href="/MVVMDoc/assets/js/39.e5e4a3b7.js"><link rel="prefetch" href="/MVVMDoc/assets/js/4.ba272e01.js"><link rel="prefetch" href="/MVVMDoc/assets/js/40.d7d2ba48.js"><link rel="prefetch" href="/MVVMDoc/assets/js/41.e1072a19.js"><link rel="prefetch" href="/MVVMDoc/assets/js/42.4ae18cf3.js"><link rel="prefetch" href="/MVVMDoc/assets/js/43.bf2c1c95.js"><link rel="prefetch" href="/MVVMDoc/assets/js/44.1754016c.js"><link rel="prefetch" href="/MVVMDoc/assets/js/45.e1be7dad.js"><link rel="prefetch" href="/MVVMDoc/assets/js/46.9afa7bbf.js"><link rel="prefetch" href="/MVVMDoc/assets/js/47.c8447f56.js"><link rel="prefetch" href="/MVVMDoc/assets/js/48.f2aead05.js"><link rel="prefetch" href="/MVVMDoc/assets/js/49.3a579f90.js"><link rel="prefetch" href="/MVVMDoc/assets/js/5.82f5b997.js"><link rel="prefetch" href="/MVVMDoc/assets/js/50.f69ca589.js"><link rel="prefetch" href="/MVVMDoc/assets/js/51.697922a6.js"><link rel="prefetch" href="/MVVMDoc/assets/js/52.f28f99b5.js"><link rel="prefetch" href="/MVVMDoc/assets/js/6.fe6717f0.js"><link rel="prefetch" href="/MVVMDoc/assets/js/7.f7d9a218.js"><link rel="prefetch" href="/MVVMDoc/assets/js/8.852896ca.js"><link rel="prefetch" href="/MVVMDoc/assets/js/9.f94093b0.js">
    <link rel="stylesheet" href="/MVVMDoc/assets/css/0.styles.a5345176.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/MVVMDoc/" class="home-link router-link-active"><!----> <span class="site-name">MVVM框架集</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Node/Koa/" class="nav-link">Koa</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/basic/" class="nav-link">Vue基础知识</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/global/" class="nav-link">Vue全局设计</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/components/" class="nav-link">Vue组件开发</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/router/" class="nav-link">Vue-Router源码</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/higher/" class="nav-link">Vue进阶知识</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/VueQS/" class="nav-link">Vue面试题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/VueArticle/" class="nav-link">Vue好文</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/Vue3/" class="nav-link">Vue3</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">React</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/basic/" class="nav-link router-link-active">React</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Router/" class="nav-link">react-router</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Redux/" class="nav-link">Redux</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/ReactQS/" class="nav-link">React的相关问题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Code/" class="nav-link">React源码理念</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Redis/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/InterviewQS/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/QSK/" class="nav-link">面试引出的知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">TypeScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/TSC/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/TSC/Axios/" class="nav-link">TypeScript封装一个Axios</a></li></ul></div></div> <a href="https://github.com/facebook201/MVVMDoc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Node/Koa/" class="nav-link">Koa</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/basic/" class="nav-link">Vue基础知识</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/global/" class="nav-link">Vue全局设计</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/components/" class="nav-link">Vue组件开发</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/router/" class="nav-link">Vue-Router源码</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/higher/" class="nav-link">Vue进阶知识</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/VueQS/" class="nav-link">Vue面试题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/VueArticle/" class="nav-link">Vue好文</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/Vue3/" class="nav-link">Vue3</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">React</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/basic/" class="nav-link router-link-active">React</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Router/" class="nav-link">react-router</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Redux/" class="nav-link">Redux</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/ReactQS/" class="nav-link">React的相关问题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Code/" class="nav-link">React源码理念</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Redis/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/InterviewQS/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/QSK/" class="nav-link">面试引出的知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">TypeScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/TSC/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/TSC/Axios/" class="nav-link">TypeScript封装一个Axios</a></li></ul></div></div> <a href="https://github.com/facebook201/MVVMDoc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div class="load-success"><div id="codefund"></div></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>React相关知识</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/MVVMDoc/MVVM/React/basic/" class="sidebar-link">React的设计思想</a></li><li><a href="/MVVMDoc/MVVM/React/basic/basic.html" class="sidebar-link">React 文档</a></li><li><a href="/MVVMDoc/MVVM/React/basic/Advance.html" class="sidebar-link">React 高级部分</a></li><li><a href="/MVVMDoc/MVVM/React/basic/Hooks.html" class="active sidebar-link">Hook</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/basic/Hooks.html#react-组件设计理念" class="sidebar-link">React 组件设计理念</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/basic/Hooks.html#动机-为什么引入hooks" class="sidebar-link">动机 (为什么引入Hooks)</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/basic/Hooks.html#hook-规则" class="sidebar-link">Hook 规则</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/basic/Hooks.html#effect-hook" class="sidebar-link">Effect Hook</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/basic/Hooks.html#class-迁移到-hooks" class="sidebar-link">Class 迁移到 Hooks</a></li></ul></li><li><a href="/MVVMDoc/MVVM/React/basic/article.html" class="sidebar-link">React好的文章</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="hook"><a href="#hook" aria-hidden="true" class="header-anchor">#</a> Hook</h1> <blockquote><p><strong>Hook 明确了你可以不在编写类组件的情况下，使用state以及其他React特性。只要 Class组件能实现的，函数式组件 + Hook 都能胜任</strong></p></blockquote> <h2 id="react-组件设计理念"><a href="#react-组件设计理念" aria-hidden="true" class="header-anchor">#</a> React 组件设计理念</h2> <ul><li>React 认为，UI 视图是数据的一种视觉映射，即 UI = F(Data)。 F函数主要是对输入数据 <strong>进行加工、并对数据的变更做出响应。</strong></li> <li>F 抽象成函数组件， React是以组件为粒度编排的应用 组件是代码复用最小的单元</li> <li>React 采用 Props属性接收外部数据，使用 state 属性来管理组件自身的数据，为了实现对数据变更做出响应需要，采用了<strong>基于 Class 的组件设计</strong></li> <li>React被认为组件是有生命周期的，因此引入组件的 created 到 destory 一系列的API</li></ul> <h3 id="class-component-的问题"><a href="#class-component-的问题" aria-hidden="true" class="header-anchor">#</a> Class Component 的问题</h3> <p>组件之间的联系，一方面是数据的共享，另一个是功能的复用。</p> <ul><li>对于组件之间的数据共享问题，React 官方采用单向数据流</li> <li>有状态的组件复用，从开始的 createClass + Mixins，后来的 Class Component，后面又有 Render Props、Higher Order Component，再到现在的 Function Component + Hooks。</li></ul> <h3 id="函数组件的缺失问题"><a href="#函数组件的缺失问题" aria-hidden="true" class="header-anchor">#</a> 函数组件的缺失问题</h3> <ul><li>函数组件是纯函数 利于组件复用和测试</li> <li>函数组件只是单纯的接收 props、绑定事件、返回jsx 本身是无状态的，所以还是依赖props传入的handle来响应数据的变更。所以函数组件不能脱离类组件。</li></ul> <h3 id="高阶组件的问题"><a href="#高阶组件的问题" aria-hidden="true" class="header-anchor">#</a> 高阶组件的问题</h3> <ul><li>嵌套地狱 每一次HOC调用都会创建一个实例</li> <li>可以使用类装饰器缓解组件嵌套带来的可维护性问题，但装饰器本质上还是 HOC</li> <li>包裹太多层级之后，props可能会覆盖</li></ul> <h3 id="render-props"><a href="#render-props" aria-hidden="true" class="header-anchor">#</a> Render Props</h3> <ul><li>数据流更加直观，子孙组件可以很明确的看到数据来源</li> <li>本质上 Render Props 是基于闭包实现的。大量地使用会引入 回调地狱的问题</li> <li>丢失组件的上下文，没有 this.props 属性，不能向 HOC那样访问 this.props.children</li></ul> <h3 id="function-component"><a href="#function-component" aria-hidden="true" class="header-anchor">#</a> Function Component</h3> <p>函数组件虽然方便使用和测试，但是只能单纯的接收 props、绑定事件 返回jsx。本身是<strong>无状态的组件，依赖传进来的props来响应数据的变更，所以Function Component不能脱离Class 组件来存在。</strong> 所以函数组件是否能脱离类组件独立存在，关键在于让函数组件自身具备状态处理能力。<strong>组件在首次render之后，组件自身能够通过某种机制再次触发状态的变更引起re-render</strong> 这种机制就是 Hooks！</p> <h3 id="函数组件和类组件的区别"><a href="#函数组件和类组件的区别" aria-hidden="true" class="header-anchor">#</a> 函数组件和类组件的区别</h3> <p><strong>在类组件中 我们一般通过 this.props 来读取父组件传来的数据，props是不可变的数据，但是this是永远可变的，所以如果组件重新渲染 this.props 就会改变。</strong></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">ProfilePage</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">showMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Followed '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>showMessage<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Follow</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果我们父组件改变了user的值，那 定时器返回的数据可能是 ”错误的“。我们可以认为这是props在某个地方弄丢了，切断了this的联系。解决方法有两种：</p> <ul><li>调用事件之前 读取 props.user，显示的传入到函数里（但是代码显得冗长 如果另一个地方也调用了 越来愈多的方法 会更加难以维护）</li> <li>JavaScript 闭包来解决</li></ul> <h2 id="动机-为什么引入hooks"><a href="#动机-为什么引入hooks" aria-hidden="true" class="header-anchor">#</a> 动机 (为什么引入Hooks)</h2> <ul><li>在组件之间复用状态逻辑很难</li> <li>复杂组件变得难以理解</li> <li>class让开发人员和计算机都难以理解</li></ul> <p>函数组件没有this，不能分配或读取 this.state。可以直接在组件中调用 useState Hook。</p> <h2 id="hook-规则"><a href="#hook-规则" aria-hidden="true" class="header-anchor">#</a> Hook 规则</h2> <p>React Hook 本质上是JavaScript函数。使用hooks 最好引入官方的 linter插件。</p> <h3 id="在最顶层使用hook"><a href="#在最顶层使用hook" aria-hidden="true" class="header-anchor">#</a> <strong>在最顶层使用Hook</strong></h3> <p>**不要在循环，条件或嵌套函数中调用 Hook **，确保在React 函数顶层调用。遵守这条规则，你就能确保 Hook 在每一次渲染中都按照同样的顺序被调用。这让 React 能够在多次的 useState 和 useEffect 调用之间保持 hook 状态的正确。</p> <h3 id="使用-react-hooks-之前的要求"><a href="#使用-react-hooks-之前的要求" aria-hidden="true" class="header-anchor">#</a> 使用 React Hooks 之前的要求</h3> <h4 id="_1、必须完整的阅读一次-hook的文档"><a href="#_1、必须完整的阅读一次-hook的文档" aria-hidden="true" class="header-anchor">#</a> 1、必须完整的阅读一次 Hook的文档</h4> <p>重点必看hooks: useState、useReducer、useEffect、useCallback、useMemo。Dan的《useEffect完全指南》衍良同学的《React Hooks完全上手指南》</p> <h4 id="_2-工程引入-lint插件-开启规则"><a href="#_2-工程引入-lint插件-开启规则" aria-hidden="true" class="header-anchor">#</a> 2 工程引入 lint插件 开启规则</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Eslint 配置</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token string">&quot;react-hooks&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;rules&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token string">&quot;react-hooks/rules-of-hooks&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 检查 Hook 的规则</span>
    <span class="token string">&quot;react-hooks/exhaustive-deps&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;warn&quot;</span> <span class="token comment">// 检查 effect 的依赖</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="调用usestate方法的时候做了什么"><a href="#调用usestate方法的时候做了什么" aria-hidden="true" class="header-anchor">#</a> 调用useState方法的时候做了什么</h4> <p>定义了一个state变量，这个变量可以由我们随便定义。它跟类组件的state是一样的，但是这个变量不会在函数退出后消失。会被React保留。</p> <h4 id="usestate-需要哪些参数？"><a href="#usestate-需要哪些参数？" aria-hidden="true" class="header-anchor">#</a> useState 需要哪些参数？</h4> <p>唯一的参数就是初始state。 需要几个变量就调用几次 useState。</p> <h4 id="usestate-方法的返回值是什么？"><a href="#usestate-方法的返回值是什么？" aria-hidden="true" class="header-anchor">#</a> useState 方法的返回值是什么？</h4> <p>当前state和更新state的函数。 需要成对获取它们。</p> <h3 id="注意点"><a href="#注意点" aria-hidden="true" class="header-anchor">#</a> 注意点</h3> <p>函数式更新：如果新的state需要先前的state计算得到，那么可以将函数传递给setState。该函数接收先前的 state，返回一个更新后的的值。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prevCount</span> <span class="token operator">=&gt;</span> prevCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">增加</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果你的更新函数返回值与当前 state 完全相同，则随后的重渲染会被完全跳过。</p> <h2 id="effect-hook"><a href="#effect-hook" aria-hidden="true" class="header-anchor">#</a> Effect Hook</h2> <p><strong>Effect Hook</strong> 可以让你在函数组件中执行副作用操作，数据获取，设置订阅以及手动更改 React 组件中的 DOM 都属于副作用。不管你知不知道这些操作，或是“副作用”这个名字，应该都在组件中使用过它们。</p> <ul><li><p>effect 每次更新渲染的时候都是一个不同的函数（<strong>记住每一次更新渲染都有自己的所有</strong>）—— 并且每个 effect函数 里面的props 和 state 都是那次属于自己的 特定渲染。effect也是渲染的一部分。</p> <p><strong>更新步骤 很重要</strong></p> <ul><li>React给一个初始的state状态</li> <li>组件本身记住要渲染的内容 和 渲染之后 要调用 这个effect</li> <li>React 告诉浏览器 要给DOM添加一些东西</li> <li>浏览器就绘制到页面上</li> <li>最后就是 React 接收到UI界面绘制完成之后 就要运行 effect函数了</li></ul></li></ul> <h4 id="清除effect-副作用-例如取消订阅"><a href="#清除effect-副作用-例如取消订阅" aria-hidden="true" class="header-anchor">#</a> 清除Effect 副作用 例如取消订阅</h4> <p>如果你的effect返回一个函数，React将会在执行清除操作时调用它。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ChatApi<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">,</span> handleFunction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果有更新操作的时候，Effect 的步骤是</p> <ul><li>React 渲染 UI</li> <li>浏览器绘制。我们在屏幕上看到 新数据的 UI</li> <li>React 清除老的 effect</li> <li>React 运行新的 effect</li></ul> <blockquote><p><em>组件内的每一个函数（包括事件处理函数，effects，定时器或者API调用等等）会捕获定义它们的那次渲染中的props和state。</em></p></blockquote> <h4 id="effect-副作用函数第二个参数-依赖-dependency"><a href="#effect-副作用函数第二个参数-依赖-dependency" aria-hidden="true" class="header-anchor">#</a> effect 副作用函数第二个参数 依赖 dependency</h4> <ul><li>如果是一个空数组 就只会在初次渲染执行一次</li> <li>如果有依赖项 当依赖项变化 effect会在渲染之后再次执行一次</li></ul> <h4 id="usecallback-usememo"><a href="#usecallback-usememo" aria-hidden="true" class="header-anchor">#</a> useCallback | useMemo</h4> <p>1、在组件内部，那些会成为其他useEffecr依赖项的方法，建议用useCallback包裹，</p> <p>2、如果函数会作为props传递给子组件，一定使用useCallback 包裹。</p> <h1 id><a href="#" aria-hidden="true" class="header-anchor">#</a></h1> <h2 id="class-迁移到-hooks"><a href="#class-迁移到-hooks" aria-hidden="true" class="header-anchor">#</a> Class 迁移到 Hooks</h2> <h3 id="生命周期方法对应-hook"><a href="#生命周期方法对应-hook" aria-hidden="true" class="header-anchor">#</a> 生命周期方法对应 Hook</h3> <ul><li><p>constructor 函数组件不需要构造函数。可以通过调用 useState 初始化 state。同事useState 接受一个函数作为参数更新</p></li> <li><p><code>getDerivedStateFromProps</code>：改为 <a href="https://reactjs.bootcss.com/docs/hooks-faq.html#how-do-i-implement-getderivedstatefromprops" target="_blank" rel="noopener noreferrer">在渲染时<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 安排一次更新。</p></li> <li><p><code>shouldComponentUpdate</code>：参考 React.memo</p></li> <li><p><code>render</code>：这是函数组件体本身。</p></li> <li><p><code>componentDidMount</code>, <code>componentDidUpdate</code>, <code>componentWillUnmount</code>：<a href="https://reactjs.bootcss.com/docs/hooks-reference.html#useeffect" target="_blank" rel="noopener noreferrer"><code>useEffect</code> Hook<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 可以表达所有这些(包括 <a href="https://reactjs.bootcss.com/docs/hooks-faq.html#can-i-skip-an-effect-on-updates" target="_blank" rel="noopener noreferrer">不那么<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://reactjs.bootcss.com/docs/hooks-faq.html#can-i-run-an-effect-only-on-updates" target="_blank" rel="noopener noreferrer">常见<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的场景)的组合。</p></li></ul> <h3 id="hooks-获取数据"><a href="#hooks-获取数据" aria-hidden="true" class="header-anchor">#</a> hooks 获取数据</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ignore <span class="token operator">=</span> <span class="token boolean">false</span>
  	<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> ret <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setData</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  	<span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> ignore<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="如何获取上一轮的-props-或-state-？"><a href="#如何获取上一轮的-props-或-state-？" aria-hidden="true" class="header-anchor">#</a> 如何获取上一轮的 props 或 state ？</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">usePrevious</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ref<span class="token punctuation">.</span>current <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> ref<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> prevCount <span class="token operator">=</span> <span class="token function">usePrevious</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Now<span class="token punctuation">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token punctuation">,</span> before<span class="token punctuation">:</span> <span class="token punctuation">{</span>prevCount<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="-2"><a href="#-2" aria-hidden="true" class="header-anchor">#</a></h3></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/facebook201/MVVMDoc/edit/master/docs/MVVM/React/basic/Hooks.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/MVVMDoc/MVVM/React/basic/Advance.html" class="prev">
          React 高级部分
        </a></span> <span class="next"><a href="/MVVMDoc/MVVM/React/basic/article.html">
          React好的文章
        </a>
        →
      </span></p></div> </div></div></div>
    <script src="/MVVMDoc/assets/js/app.0ce0ee86.js" defer></script><script src="/MVVMDoc/assets/js/16.500fcba6.js" defer></script>
  </body>
</html>
