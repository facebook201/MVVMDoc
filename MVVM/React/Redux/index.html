<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redux 简单教程 | MVVM框架集</title>
    <meta name="description" content="飘飘乎如遗世独立 羽化而登仙">
    <link rel="icon" href="/MVVMDoc/pkq.jpeg">
    
    <link rel="preload" href="/MVVMDoc/assets/css/0.styles.a5345176.css" as="style"><link rel="preload" href="/MVVMDoc/assets/js/app.0ce0ee86.js" as="script"><link rel="preload" href="/MVVMDoc/assets/js/11.22b73831.js" as="script"><link rel="prefetch" href="/MVVMDoc/assets/js/10.8c942620.js"><link rel="prefetch" href="/MVVMDoc/assets/js/12.bc9ef78f.js"><link rel="prefetch" href="/MVVMDoc/assets/js/13.9b0b8518.js"><link rel="prefetch" href="/MVVMDoc/assets/js/14.09b24188.js"><link rel="prefetch" href="/MVVMDoc/assets/js/15.16367390.js"><link rel="prefetch" href="/MVVMDoc/assets/js/16.500fcba6.js"><link rel="prefetch" href="/MVVMDoc/assets/js/17.2160c3ed.js"><link rel="prefetch" href="/MVVMDoc/assets/js/18.a1b98696.js"><link rel="prefetch" href="/MVVMDoc/assets/js/19.3774a35c.js"><link rel="prefetch" href="/MVVMDoc/assets/js/2.a1f8879c.js"><link rel="prefetch" href="/MVVMDoc/assets/js/20.f39149de.js"><link rel="prefetch" href="/MVVMDoc/assets/js/21.9fe5b26c.js"><link rel="prefetch" href="/MVVMDoc/assets/js/22.2676caf5.js"><link rel="prefetch" href="/MVVMDoc/assets/js/23.4b011396.js"><link rel="prefetch" href="/MVVMDoc/assets/js/24.673ebd68.js"><link rel="prefetch" href="/MVVMDoc/assets/js/25.753ad69b.js"><link rel="prefetch" href="/MVVMDoc/assets/js/26.0ecb2d6f.js"><link rel="prefetch" href="/MVVMDoc/assets/js/27.f9450161.js"><link rel="prefetch" href="/MVVMDoc/assets/js/28.17f8fd8b.js"><link rel="prefetch" href="/MVVMDoc/assets/js/29.9faae8cf.js"><link rel="prefetch" href="/MVVMDoc/assets/js/3.c5e28420.js"><link rel="prefetch" href="/MVVMDoc/assets/js/30.bc250b25.js"><link rel="prefetch" href="/MVVMDoc/assets/js/31.bda37d6f.js"><link rel="prefetch" href="/MVVMDoc/assets/js/32.bbbeaf28.js"><link rel="prefetch" href="/MVVMDoc/assets/js/33.873dcf9d.js"><link rel="prefetch" href="/MVVMDoc/assets/js/34.a482e32a.js"><link rel="prefetch" href="/MVVMDoc/assets/js/35.3cb5f8ee.js"><link rel="prefetch" href="/MVVMDoc/assets/js/36.dbefa361.js"><link rel="prefetch" href="/MVVMDoc/assets/js/37.7f28fb99.js"><link rel="prefetch" href="/MVVMDoc/assets/js/38.fcc3ff8b.js"><link rel="prefetch" href="/MVVMDoc/assets/js/39.e5e4a3b7.js"><link rel="prefetch" href="/MVVMDoc/assets/js/4.ba272e01.js"><link rel="prefetch" href="/MVVMDoc/assets/js/40.d7d2ba48.js"><link rel="prefetch" href="/MVVMDoc/assets/js/41.e1072a19.js"><link rel="prefetch" href="/MVVMDoc/assets/js/42.4ae18cf3.js"><link rel="prefetch" href="/MVVMDoc/assets/js/43.bf2c1c95.js"><link rel="prefetch" href="/MVVMDoc/assets/js/44.1754016c.js"><link rel="prefetch" href="/MVVMDoc/assets/js/45.e1be7dad.js"><link rel="prefetch" href="/MVVMDoc/assets/js/46.9afa7bbf.js"><link rel="prefetch" href="/MVVMDoc/assets/js/47.c8447f56.js"><link rel="prefetch" href="/MVVMDoc/assets/js/48.f2aead05.js"><link rel="prefetch" href="/MVVMDoc/assets/js/49.3a579f90.js"><link rel="prefetch" href="/MVVMDoc/assets/js/5.82f5b997.js"><link rel="prefetch" href="/MVVMDoc/assets/js/50.f69ca589.js"><link rel="prefetch" href="/MVVMDoc/assets/js/51.697922a6.js"><link rel="prefetch" href="/MVVMDoc/assets/js/52.f28f99b5.js"><link rel="prefetch" href="/MVVMDoc/assets/js/6.fe6717f0.js"><link rel="prefetch" href="/MVVMDoc/assets/js/7.f7d9a218.js"><link rel="prefetch" href="/MVVMDoc/assets/js/8.852896ca.js"><link rel="prefetch" href="/MVVMDoc/assets/js/9.f94093b0.js">
    <link rel="stylesheet" href="/MVVMDoc/assets/css/0.styles.a5345176.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/MVVMDoc/" class="home-link router-link-active"><!----> <span class="site-name">MVVM框架集</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Node/Koa/" class="nav-link">Koa</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/basic/" class="nav-link">Vue基础知识</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/global/" class="nav-link">Vue全局设计</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/components/" class="nav-link">Vue组件开发</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/router/" class="nav-link">Vue-Router源码</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/higher/" class="nav-link">Vue进阶知识</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/VueQS/" class="nav-link">Vue面试题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/VueArticle/" class="nav-link">Vue好文</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/Vue3/" class="nav-link">Vue3</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">React</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/basic/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Router/" class="nav-link">react-router</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Redux/" class="nav-link router-link-exact-active router-link-active">Redux</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/ReactQS/" class="nav-link">React的相关问题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Code/" class="nav-link">React源码理念</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Redis/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/InterviewQS/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/QSK/" class="nav-link">面试引出的知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">TypeScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/TSC/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/TSC/Axios/" class="nav-link">TypeScript封装一个Axios</a></li></ul></div></div> <a href="https://github.com/facebook201/MVVMDoc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Node/Koa/" class="nav-link">Koa</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/basic/" class="nav-link">Vue基础知识</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/global/" class="nav-link">Vue全局设计</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/components/" class="nav-link">Vue组件开发</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/router/" class="nav-link">Vue-Router源码</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/higher/" class="nav-link">Vue进阶知识</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/VueQS/" class="nav-link">Vue面试题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/VueArticle/" class="nav-link">Vue好文</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Vue/Vue3/" class="nav-link">Vue3</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">React</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/basic/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Router/" class="nav-link">react-router</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Redux/" class="nav-link router-link-exact-active router-link-active">Redux</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/ReactQS/" class="nav-link">React的相关问题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/React/Code/" class="nav-link">React源码理念</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/Redis/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/InterviewQS/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/QSK/" class="nav-link">面试引出的知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">TypeScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/TSC/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/MVVMDoc/MVVM/TSC/Axios/" class="nav-link">TypeScript封装一个Axios</a></li></ul></div></div> <a href="https://github.com/facebook201/MVVMDoc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div class="load-success"><div id="codefund"></div></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Redux</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/MVVMDoc/MVVM/React/Redux/" class="active sidebar-link">Redux 简单教程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#flux-单向数据流图" class="sidebar-link">Flux 单向数据流图</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#图谱解析" class="sidebar-link">图谱解析</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#action-creator" class="sidebar-link">action-creator</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#state-相关" class="sidebar-link">State 相关</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#reducer" class="sidebar-link">Reducer</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#get-state" class="sidebar-link">get_State</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#多个action的reducer" class="sidebar-link">多个action的reducer</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#dispatch-分发" class="sidebar-link">dispatch 分发</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#dispatch-async-action" class="sidebar-link">dispatch async action</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#middleware-中间件" class="sidebar-link">middleware 中间件</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#state-subscriber" class="sidebar-link">state-subscriber</a></li><li class="sidebar-sub-header"><a href="/MVVMDoc/MVVM/React/Redux/#provider-connect" class="sidebar-link">Provider-connect</a></li></ul></li><li><a href="/MVVMDoc/MVVM/React/Redux/Introduction.html" class="sidebar-link">Redux 核心内容</a></li><li><a href="/MVVMDoc/MVVM/React/Redux/Other.html" class="sidebar-link">理解Redux</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="redux-简单教程"><a href="#redux-简单教程" aria-hidden="true" class="header-anchor">#</a> Redux 简单教程</h1> <h2 id="flux-单向数据流图"><a href="#flux-单向数据流图" aria-hidden="true" class="header-anchor">#</a> Flux 单向数据流图</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>                 _________               ____________               ___________
                <span class="token operator">|</span>         <span class="token operator">|</span>             <span class="token operator">|</span>            <span class="token operator">|</span>             <span class="token operator">|</span>           <span class="token operator">|</span>
                <span class="token operator">|</span> Action  <span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>▶<span class="token operator">|</span> Dispatcher <span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>▶<span class="token operator">|</span> callbacks <span class="token operator">|</span>
                <span class="token operator">|</span>_________<span class="token operator">|</span>             <span class="token operator">|</span>____________<span class="token operator">|</span>             <span class="token operator">|</span>___________<span class="token operator">|</span>
                     ▲                                                   <span class="token operator">|</span>
                     <span class="token operator">|</span>                                                   <span class="token operator">|</span>
                     <span class="token operator">|</span>                                                   <span class="token operator">|</span>
 _________       ____<span class="token operator">|</span>_____                                          ____▼____
<span class="token operator">|</span>         <span class="token operator">|</span>◀<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>  Action  <span class="token operator">|</span>                                        <span class="token operator">|</span>         <span class="token operator">|</span>
<span class="token operator">|</span> Web <span class="token constant">API</span> <span class="token operator">|</span>     <span class="token operator">|</span> Creators <span class="token operator">|</span>                                        <span class="token operator">|</span>  Store  <span class="token operator">|</span>
<span class="token operator">|</span>_________<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span>▶<span class="token operator">|</span>__________<span class="token operator">|</span>                                        <span class="token operator">|</span>_________<span class="token operator">|</span>
                     ▲                                                   <span class="token operator">|</span>
                     <span class="token operator">|</span>                                                   <span class="token operator">|</span>
                 ____<span class="token operator">|</span>________           ____________                ____▼____
                <span class="token operator">|</span>   User       <span class="token operator">|</span>         <span class="token operator">|</span>   React   <span class="token operator">|</span>              <span class="token operator">|</span> Change  <span class="token operator">|</span>
                <span class="token operator">|</span> interactions <span class="token operator">|</span>◀<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>   Views   <span class="token operator">|</span>◀<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span> events  <span class="token operator">|</span>
                <span class="token operator">|</span>______________<span class="token operator">|</span>         <span class="token operator">|</span>___________<span class="token operator">|</span>              <span class="token operator">|</span>_________<span class="token operator">|</span>
</code></pre></div><h2 id="图谱解析"><a href="#图谱解析" aria-hidden="true" class="header-anchor">#</a> 图谱解析</h2> <p>获取数据是一个action，一个点击是一个action，一个input变化也是一个action。不同于直接修改 Model和View，Flux确保所有action首先通过一个dispatcher，然后再是store，最后通知所有的store监听器。
Store只能被action修改，别无他选。并且当所有Store响应了action之后，View才会最终更新。所以数据总是沿着一个方向流动：
<strong>action -&gt; store -&gt; view -&gt; action -&gt; store -&gt; view -&gt; action -&gt;</strong></p> <h2 id="action-creator"><a href="#action-creator" aria-hidden="true" class="header-anchor">#</a> action-creator</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// action-creator 就是个函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">actionCreator</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 负责构建一个action 并且返回它</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'AN_ACTION'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>action的格式，一般是一个拥有type属性的对象。然后按type决定如何处理action，它还有其他的属性，可以存放任意想要的数据。action creator 实际上可以返回 action 以外的其他东西，比如一个函数。这在处理异步时很有用。</p> <p>直接调用 action creator，如同预期的一样，我们会得到一个 action：
console.log（actionCreator())
// 输出： { type: 'AN_ACTION' }</p> <p>在实际的场景中，我们需要的是将 action 发送到某个地方，让关心它的人知道发生了什么，并且做出相应的处理。我们将这个过程称之为“分发 action（Dispatching an action）”。</p> <p>为了分发action，需要一个分发函数。并且为了任何对它感兴趣的人都能感知到action发起。</p> <h2 id="state-相关"><a href="#state-相关" aria-hidden="true" class="header-anchor">#</a> State 相关</h2> <p>我们把应用程序的数据称之为状态，我们所说的数据会随着时间的推移发生变化，这就是应用的状态。Redux 就是一个容纳状态的容器。</p> <h3 id="怎么修改这些数据"><a href="#怎么修改这些数据" aria-hidden="true" class="header-anchor">#</a> 怎么修改这些数据</h3> <p>reducer 函数修改数据，reducer是action的订阅者， Reducer只是一个纯函数，接受应用程序的当前状态以及发生的action，然后返回修改后的新状态。使用订阅者来变更传播数据到整个应用程序。</p> <h3 id="redux提供了？"><a href="#redux提供了？" aria-hidden="true" class="header-anchor">#</a> Redux提供了？</h3> <ul><li>存放应用程序状态的容器</li> <li>一种把action分发到状态修改器的机制、也就是reducer函数</li> <li>监听状态变化的机制</li></ul> <h3 id="实例"><a href="#实例" aria-hidden="true" class="header-anchor">#</a> 实例</h3> <p>我们把Redux实例称为 store 并用下面的方式创建：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 但是当你运行上述代码，你会发现以下异常消息：Error: Invariant Violation: Expected the reducer to be a function. 因为 createStore 函数必须接收一个能够修改应用状态的函数。</span>

<span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="reducer"><a href="#reducer" aria-hidden="true" class="header-anchor">#</a> Reducer</h2> <p>创建一个Redux的实例，管理应用中的state。看看Reducer是怎么转换state的。
在之前的图里面，只有 Store，没有Reducer。那么Store与Reducer到底有什么区别？
<strong>Store可以保存你的data，但是Reducer不能。在传统的 Flux 中，Store 本身可以保存 state，但在 Redux 中，每次调用 reducer时，都会传入待更新的 state。这样的话，Redux 的 store 就变成了“无状态的 store” 并且改了个名字叫 Reducer。</strong></p> <p>所以在上面的实例前，创建一个Redux实例前，需要给它一个 reducer 函数。每当一个action发生的时候，Redux都能调用这个函数，往 createStore 传Reducer的过程
就是给 Redux 绑定 action 处理函数（也就是reducer）的过程。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Reducer was called with args'</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>reducer被调用了，但是没有dispatch任何action，这是因为初始化应用state的时候，dispatch 了一个初始化的 action（{ type: '@@redux/INIT' })。
在被调用的时候，一个 reducer 会得到这些参数 (state, action),初始化的时候state是undefined。处理 init action之后。会怎样呢？</p> <h2 id="get-state"><a href="#get-state" aria-hidden="true" class="header-anchor">#</a> get_State</h2> <p>怎么从 Redux 中读取 state？</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reducer was called with state'</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出: reducer_0 was called with state undefined and action { type: '@@redux/INIT' }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'store_0 state after initialization:'</span><span class="token punctuation">,</span> store_0<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出: store_0 state after initialization: undefined</span>
</code></pre></div><p>为了读取 Redux 保存的 state，可以调用 getState。 reducer 只是一个函数，接收到程序当前的state和action，然后返回一个modify过的心的 state。我们的reducer目前什么都不返回，所以程序的state当然只能是 reducer() 返回的那个叫 undefined 的东西。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>调用  reducer ，只是为了响应一个派发来的 action，接下来，我们在 response 里模拟一个 state 修改，其响应的 action 类型是 'SAY_SOMETIHG'。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'SAY_SOMETHING'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        message<span class="token punctuation">:</span> action<span class="token punctuation">.</span>value
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="0"><li>我假设了 action 里一定包含了一个 type 跟一个 value 。type 基本上是 flux action 已经约定俗成的， 而 value 属性可以是任何类型的。</li> <li>这里有个常见模式：在 reducer 里用 switch 来响应对应的 action 。</li> <li>用 switch 的时候， <strong>永远</strong> 不要忘记放个 “default” 来返回 “state”，否则，你的 reducer 可能会返回 “undefined” （等于你的 state 就丢了）</li> <li>注意 { message: action.value } 是怎么被合并到当前 state 来形成新 state 的，这全要感谢牛逼的 ES7 notation (Object Spread): { ...state, message: action.value }</li> <li>还要注意：之所以这个例子能用ES7 Object Spread notation ，是因为它只对 state 里的{ message: action.value} 做了浅拷贝（也就是说， state 第一个层级的属性直接被 { message: action.value } 覆盖掉了 —— 与之相对，其实也有优雅的合并方式 ）但是如果数据结构更复杂或者是嵌套的，那处理state更新的时候，很可能还需要考虑一些完全不同的做法：</li></ol> <ul><li>可以考虑： Immutable.js (https://facebook.github.io/immutable-js/)</li> <li>可以考虑： Object.assign (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)</li> <li>可以考虑： 手工合并</li> <li>又或者考虑用其它任何能满足需要且适合 state 结构的方法，Redux 对此是全无预设的方式的（要记得 Redux 只是个状态的容器）。</li></ul> <p>下面要在 reducer 里处理 action 了，我们将会有多个 reducer 并会组合它们。</p> <h2 id="多个action的reducer"><a href="#多个action的reducer" aria-hidden="true" class="header-anchor">#</a> 多个action的reducer</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer_1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'SAY_SOMETHING'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token operator">...</span>state<span class="token punctuation">,</span>
                message<span class="token punctuation">:</span> action<span class="token punctuation">.</span>value
            <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token string">'DO_SOMETHING'</span><span class="token punctuation">:</span>
            <span class="token comment">// ...</span>
        <span class="token keyword">case</span> <span class="token string">'LEARN_SOMETHING'</span><span class="token punctuation">:</span>
            <span class="token comment">// ...</span>
        <span class="token keyword">case</span> <span class="token string">'HEAR_SOMETHING'</span><span class="token punctuation">:</span>
            <span class="token comment">// ...</span>
        <span class="token keyword">case</span> <span class="token string">'GO_SOMEWHERE'</span><span class="token punctuation">:</span>
            <span class="token comment">// ...</span>
        <span class="token comment">// etc.</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果一个reducer去维护整个项目，项目就会变得很很难维护，所以如果有多个reducer，Redux会帮我们合并reducer。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">userReducer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// etc.</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">itemsReducer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// etc.</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>不同的reducer是可以接收不同类型的state，数据结构作为 state 的值。（例如，字面量对象、数组、布尔值、字符串或其它不可变结构）。多个reducer的模式下，可以让每个reducer只处理整个应用的部分 state。那么怎么合并所有的reducer，如何告诉Redux 每个 reducer 只处理一部分state呢？ combineReducers辅助函数。</p> <p><strong>combineReducers 接收一个对象并返回一个函数，当combineReducers 被调用时，它会去调用每个reducer，并把返回的每一块 state 重新组合成一个大的state对象，也就是Redux中的Store。</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

<span class="token keyword">var</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> userReducer<span class="token punctuation">,</span>
    items<span class="token punctuation">:</span> itemsReducer
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> store_0 <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
</code></pre></div><p>从输出中看到的，每个 reducer 都被正确地调用了（但接收了个 init action @@redux/INIT ）。这个 action 是什么鬼？这是 combineReducers 实施的一次安全检查，用以确保 reducer 永远不会返回undefined。请注意，在 combineReducers 中第一次调用 init action 时，其实是随机 action 来的，但它们有个共同的目的 (即是做一个安全检查)。</p> <p>Redux 正确处理了 state 的各个部分。最终的 state 完全是一个简单的对象，由userReducer 和 itemsReducer 返回的部分 state 共同组成。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>由于我们为每个 reducer 初始化了一个特殊的值（userReducer 的是空对象 {} ，itemsReducer 的是空数组 [] ）,所以在最终 Redux 的 state 中找到那些值并不是巧合。</p> <h2 id="dispatch-分发"><a href="#dispatch-分发" aria-hidden="true" class="header-anchor">#</a> dispatch 分发</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">userReducer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'SET_NAME'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token operator">...</span>state<span class="token punctuation">,</span>
                name<span class="token punctuation">:</span> action<span class="token punctuation">.</span>name
            <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">itemsReducer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'ADD_ITEM'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>
                <span class="token operator">...</span>state<span class="token punctuation">,</span>
                action<span class="token punctuation">.</span>item
            <span class="token punctuation">]</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">var</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> userReducer<span class="token punctuation">,</span>
    items<span class="token punctuation">:</span> itemsReducer
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { user: {}, items: [] }</span>
</code></pre></div><p>现在来dispatch第一个action，<strong>为了dispatch一个action，需要一个dispatch函数</strong>。我们所看到的dispatch函数，是redux提供的，并且它会将action传递给任何一个reducer！dispatch本质上是 Redux的实例的属性 ”dispatch“</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>store_0<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'AN_ACTION'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// userReducer was called with state {} and action { type: 'AN_ACTION' }</span>
<span class="token comment">// itemsReducer was called with state [] and action { type: 'AN_ACTION' }</span>
<span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">setNameActionCreator</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">'SET_NAME'</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> name
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">setNameActionCreator</span><span class="token punctuation">(</span><span class="token string">'bob'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'bob'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre></div><p>每一个 reducer 都被调用了，但是没有一个 action type 是 reducer需要的。因此state是不会发生变化。上面我们处理了一个action，然后改变了应用的state。
目前的流程是这样的 ActionCreator -&gt; Action -&gt; dispatcher -&gt; reducer</p> <h2 id="dispatch-async-action"><a href="#dispatch-async-action" aria-hidden="true" class="header-anchor">#</a> dispatch async action</h2> <p>假设现在有一个场景：</p> <ol><li>用户点击 &quot;Say Hi in 2 seconds 按钮&quot;</li> <li>当用户点击按钮A，我们希望经过两秒，视图显示一条消息 Hi。</li> <li>两秒过去之后 视图更新 显示消息</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">speaker</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'SAY'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>state<span class="token punctuation">,</span>
          message<span class="token punctuation">:</span> action<span class="token punctuation">.</span>message
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
          <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">sayActionCreator</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'SAY'</span><span class="token punctuation">,</span>
    message
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="middleware-中间件"><a href="#middleware-中间件" aria-hidden="true" class="header-anchor">#</a> middleware 中间件</h2> <p>通常来说中间件是在某个应用中 A 和 B 部分中间的那一块，中间件可以把 A 发送数据到 B 的形式从 A ====&gt; B,
变成 A ---&gt; middleware 1 ---&gt; middleware 2 ---&gt; middleware 3 --&gt; ... ---&gt; B。Redux 并不能自动处理 action creator 中返回的异步函数。如果在 action creator 和 reducer 之间增加一个中间件，就可以把这个函数转成适合Redux处理的内容。
action ---&gt; dispatcher ---&gt; middleware 1 ---&gt; middleware 2 ---&gt; reducers。</p> <p>每当一个 action（或者其他诸如异步 action creator 中的某个函数）被分发时，我们的中间件就会被调用并且在需要的时候协助 action creator 分发真正的 action（或者什么都不做）</p> <p>在 Redux 中，中间件是纯粹的函数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">anyMiddleware</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> getState <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 中间件的业务代码</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 柯里化</span>
<span class="token keyword">var</span> thunkMiddleware <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> getState <span class="token punctuation">}</span><span class="token punctuation">,</span> next<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
    <span class="token comment">// TODO</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p><strong>中间件由三个嵌套函数组成</strong></p> <ul><li><ol><li>第一层向其他两层提供分发函数和getState函数 （因为中间件或者 ation creator 可能需要从state中读取数据）</li></ol></li> <li><ol start="2"><li>第二层提供next函数，它允许你显式的将处理过的输入传递给下一个中间件或Redux</li></ol></li> <li><ol start="3"><li>第三层提供上一个中间件或dispatch传过来的action，这个action可以调用一个中间件 或者 以想要的方式处理action。</li></ol></li></ul> <p>为异步 action creator 提供的中间件叫 thunk middleware</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">thunkMiddleware</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> getState <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log('Enter thunkMiddleware');</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log('Function &quot;next&quot; provided:', next);</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// console.log('Handling action:', action);</span>
            <span class="token keyword">return</span> <span class="token keyword">typeof</span> action <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span>
                <span class="token function">action</span><span class="token punctuation">(</span>dispatch<span class="token punctuation">,</span> getState<span class="token punctuation">)</span> <span class="token punctuation">:</span>
                <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="辅助函数-applymiddleware-然redux知道有一个或多个中间件"><a href="#辅助函数-applymiddleware-然redux知道有一个或多个中间件" aria-hidden="true" class="header-anchor">#</a> 辅助函数 applyMiddleware 然redux知道有一个或多个中间件</h4> <p>applyMiddleware 接收所有中间件作为参数，返回一个供 Redux createStore 调用的函数。当最后这个函数被调用时，它会产生一个 Store 增强器，用来将所有中间件应用到 Store 的 dispatch 上。</p> <h4 id="如何应用？"><a href="#如何应用？" aria-hidden="true" class="header-anchor">#</a> 如何应用？</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> combineReducers<span class="token punctuation">,</span> applyMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

<span class="token keyword">const</span> finalCreateStore <span class="token operator">=</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunkMiddleware<span class="token punctuation">)</span><span class="token punctuation">(</span>createStore<span class="token punctuation">)</span>
<span class="token comment">// 针对多个中间件， 使用：applyMiddleware(middleware1, middleware2, ...)(createStore)</span>

<span class="token keyword">var</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">speaker</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'speaker was called with state'</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token string">'and action'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'SAY'</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token punctuation">{</span>
                    <span class="token operator">...</span>state<span class="token punctuation">,</span>
                    message<span class="token punctuation">:</span> action<span class="token punctuation">.</span>message
                <span class="token punctuation">}</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> state
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> store_0 <span class="token operator">=</span> <span class="token function">finalCreateStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
</code></pre></div><p>现在 store 的 middleware 已经准备好了，再来尝试分发我们的异步 action：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">asyncSayActionCreator_1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Dispatch action now:'</span><span class="token punctuation">)</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                type<span class="token punctuation">:</span> <span class="token string">'SAY'</span><span class="token punctuation">,</span>
                message
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">discardMiddleware</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> getState <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'discardMiddleware action received:'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> finalCreateStore <span class="token operator">=</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>discardMiddleware<span class="token punctuation">,</span> thunkMiddleware<span class="token punctuation">)</span><span class="token punctuation">(</span>createStore<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过使用 logMiddleware 或 discardMiddleware 试着修改上述的 finalCreateStore 调用,</p> <ol><li>我们知道怎样写 action 和 action creator</li> <li>我们知道怎样分发 action</li> <li>我们知道怎样使用中间件处理自定义 action，比如异步 action</li></ol> <p><strong>如何订阅 state 的更新, 并响应这些更新（比如重新渲染我们的组件)</strong></p> <h2 id="state-subscriber"><a href="#state-subscriber" aria-hidden="true" class="header-anchor">#</a> state-subscriber</h2> <p>没有下面的这个图，在 store 改变时我们就不能更新我们的视图。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  _________      _________       ___________
  <span class="token operator">|</span>         <span class="token operator">|</span>    <span class="token operator">|</span> Change  <span class="token operator">|</span>     <span class="token operator">|</span>   React   <span class="token operator">|</span>
  <span class="token operator">|</span>  Store  <span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span>▶ events  <span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>▶   Views   <span class="token operator">|</span>
  <span class="token operator">|</span>_________<span class="token operator">|</span>    <span class="token operator">|</span>_________<span class="token operator">|</span>     <span class="token operator">|</span>___________<span class="token operator">|</span>

<span class="token comment">// 监视 Redux store 更新有一个很简单的办法：</span>
store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// retrieve latest store state here</span>
  <span class="token comment">// Ex:</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

<span class="token keyword">var</span> <span class="token function-variable function">itemsReducer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'ADD_ITEM'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>
                <span class="token operator">...</span>state<span class="token punctuation">,</span>
                action<span class="token punctuation">.</span>item
            <span class="token punctuation">]</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span> items<span class="token punctuation">:</span> itemsReducer <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> store_0 <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

store_0<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    store_0<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在这里更新你的视图</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> <span class="token function-variable function">addItemActionCreator</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">'ADD_ITEM'</span><span class="token punctuation">,</span>
        item<span class="token punctuation">:</span> item
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
store_0<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addItemActionCreator</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1234</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">'anything'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>如何取消订阅，究竟是怎么更新视图的，我们怎么吧Redux和React结合到一起？
使用 “provide” 和 “connect” 绑定，不必再关心隐含在内的订阅方法。</p> <h2 id="provider-connect"><a href="#provider-connect" aria-hidden="true" class="header-anchor">#</a> Provider-connect</h2> <p>开发一个React应用和服务器来让浏览器可以访问，我们会用到：</p> <ul><li>node HTTP 创建一个非常简单的服务器</li> <li>用 webpack 去打包我们的应用</li> <li>神奇的 webpack Dev Server</li> <li>react hot loader</li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/facebook201/MVVMDoc/edit/master/docs/MVVM/React/Redux/README.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/MVVMDoc/MVVM/React/Redux/Introduction.html">
          Redux 核心内容
        </a>
        →
      </span></p></div> </div></div></div>
    <script src="/MVVMDoc/assets/js/app.0ce0ee86.js" defer></script><script src="/MVVMDoc/assets/js/11.22b73831.js" defer></script>
  </body>
</html>
