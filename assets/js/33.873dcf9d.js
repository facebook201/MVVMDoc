(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{203:function(t,e,i){"use strict";i.r(e);var s=i(0),n=Object(s.a)({},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),i("p",[i("a",{attrs:{href:"https://www.zhihu.com/people/frank-zhang/activities",target:"_blank",rel:"noopener noreferrer"}},[t._v("来自知乎Furybean"),i("OutboundLink")],1)]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),i("p",[t._v("实现虚拟列表就是处理滚动条滚动后的可见区域的变更")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),i("p",[t._v("上面的高度属性是定死的。我们可以动态高度来做")]),t._v(" "),t._m(9),t._v(" "),i("p",[t._v("第二种方法更好，新增一个 itemSizeGetter 属性 来获取每个列表项的高度。")]),t._v(" "),t._m(10)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"前端好文"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端好文","aria-hidden":"true"}},[this._v("#")]),this._v(" 前端好文")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"前端虚拟列表的实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端虚拟列表的实现","aria-hidden":"true"}},[this._v("#")]),this._v(" 前端虚拟列表的实现")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"实现思路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现思路","aria-hidden":"true"}},[this._v("#")]),this._v(" 实现思路")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("DOM元素的创建和渲染需要的时间成本很高，在大数据的情况下，完整渲染列表所需要的时间不可接收。其中一个解决思路就是在任何情况下只对「"),e("strong",[this._v("可见区域")]),this._v(" 」渲染，初次可以到达很高的渲染性能。下面是虚拟列表的两个概念")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("可滚动区域: 假设有1000条数据，每个列表项的高度是30，那么可滚动的区域的高度是 1000 * 30。当用户改变列表的滚动条的当前滚动值的时候，会造成可见区域的内容的变。")]),this._v(" "),e("li",[this._v("可见区域：比如列表高度是 300，右侧有纵向滚动条可以滚动，视觉可见的区域就是可见区域。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("1、计算当前可见区域起始数据的 startIndex")]),this._v(" "),e("li",[this._v("2、计算当前可见区域结束数据的 endIndex")]),this._v(" "),e("li",[this._v("3、计算当前可见区域的数据、并渲染到页面中")]),this._v(" "),e("li",[this._v("4、计算starIndex对应数据在整个列表中的偏移位置 startOffset, 设置到列表上")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"https://pic3.zhimg.com/80/v2-f00bb3f5d9815d660d7bcbd87236af86_hd.jpg",alt:"border"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-vue extra-class"},[e("pre",{pre:!0,attrs:{class:"language-vue"}},[e("code",[this._v("  computed: {\n    contentHeight() {\n      return this.data.length * this.itemHeight + 'px';\n    }\n  },\n    handleScroll() {\n      const scrollTop = this.$el.scrollTop;\n      this.updateVisibleData(scrollTop);\n    },\n    updateVisibleData(scrollTop = 0) {\n      const visibleCount = Math.ceil(this.$el.clientHeight / this.itemHeight);\n      const start = Math.floor(scrollTop / this.itemHeight);\n      const end = start + visibleCount;\n      this.visibleData = this.data.slice(start, end);\n      this.$refs.content.style.webkitTransform = `translate3d(0, ${start * this.itemHeight}px, 0)`;\n    }\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"去掉限制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#去掉限制","aria-hidden":"true"}},[this._v("#")]),this._v(" 去掉限制")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("添加一个数组类型的prop，每个列表项的高度通过索引来获得")]),this._v(" "),e("li",[this._v("添加一个获取列表项高度的方法，给这个方法传入item和index、返回对应列表项的高度")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-vue extra-class"},[e("pre",{pre:!0,attrs:{class:"language-vue"}},[e("code",[this._v("\nprops: {\n  itemSizeGetter: {\n    type: Function\n  }\n}\n\n\ncomputed: {\n  // 每行高度不一样 所以 contentHeight 算法要更新。\n  contentHeight() {\n    const { data, itemSizeGetter } = this;\n    let total = 0;\n\n    for (let i = 0, i < data.length; i < j; ++i) {\n      // 计算每次的高度 最后加起来返回\n      total += itemSizeGetter.call(null, data[i], i);\n    }\n    return total;\n  }\n}\n")])])])}],!1,null,null,null);e.default=n.exports}}]);